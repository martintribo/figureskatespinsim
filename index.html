<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>title</title>
</head>
<body>
    <canvas id="rink-canvas" width="800" height="600" style="display: inline;"></canvas>
    <canvas id="skate-canvas" width="80" height="200" style="display: inline;"></canvas>
    <span id="leanx" style="vertical-align: top;"></span>
</body>
<script>
    var WIDTH = 800;
    var HEIGHT = 600;
    var FWIDTH = 80;
    var FLENGTH = 200;
    var leanXTxt = document.querySelector('#leanx');
    
    var leanX = 0;
    var leanY = 0.5;
    var orientation = Math.PI * 3 / 2;
    var x = 400;
    var y = 300;
    var angVel = 0;
    var velocity = 40;
    
    var interval = 33;
    var ticksPerSecond = 1000 / interval;

    setInterval(function () {
        angVel = leanX * Math.PI;

        var sAngVel = angVel / ticksPerSecond;
        orientation += sAngVel;

        var sVel = velocity / ticksPerSecond;
        x += Math.cos(orientation) * sVel;
        y += Math.sin(orientation) * sVel;


        if (x < 0 || x > WIDTH || y < 0 || y > HEIGHT) {
            x = 400;
            y = 300;
        }
        render();
        renderSkateDiagram();
    }, 33);

    /*
    States
        Body Angular Momentum
        Angular Velocity
        Skate forward/backward speed
        Lean (consider angle of skate now, weight/muscle tension should be considered later)
            Side
            Forward/Backward
        Blade radius at current vertical lean
        Skate Orientation
        Skate Position
    
    State for frame
        Skate Forward/Backward Speed
            get value from last frame
            modified by lean
        Angular Velocity
            value from last frame
            + lean modifier
            +/- Restriction from 
        Skate Orientation
            Old Value
            + Angular Momentum Modifier
        Lean
            Old value
            + Arrow key modifier
            [] Restrain within limits
        Skate Position
            New Orientation * Forward/Backward Speed
    
    */

    var lxModifier = 0.1;
    var lyModifier = 0.1;
    document.addEventListener('keydown', function (e) {
        console.log(e.keyCode);
        if (e.keyCode === 37) {
            leanX -= lxModifier;
        } else if (e.keyCode === 39) {
            leanX += lxModifier;
        } else if (e.keyCode === 38) {
            leanY += lyModifier;
        } else if (e.keyCode === 40) {
            leanY -= lyModifier;
        }

        leanX = Math.min(leanX, 1);
        leanX = Math.max(leanX, -1);
        leanY = Math.min(leanY, 1);
        leanY = Math.max(leanY, -1);
    });

    var canvas = document.querySelector('#rink-canvas');
    var ctx = canvas.getContext('2d');
    function render() {
        leanXTxt.innerHTML = leanX;
        ctx.setTransform(1, 0, 0, 1, 0, 0);

        ctx.fillStyle = 'lightblue';
        ctx.fillRect(0, 0, WIDTH, HEIGHT);

        ctx.translate(x, y);
        ctx.rotate(orientation);

        ctx.fillStyle = 'red';
        ctx.fillRect(-5, -5, 10, 10);
    }

    var skateCanvas = document.querySelector('#skate-canvas');
    var sctx = skateCanvas.getContext('2d');
    function renderSkateDiagram() {
        sctx.setTransform(1, 0, 0, 1, 0, 0);
        sctx.fillStyle = 'black';
        sctx.fillRect(0, 0, 80, 200);

        // TODO: Draw line for rocker starting point/range

        sctx.translate(FWIDTH / 2, FLENGTH / 2);
        sctx.translate(leanX * FWIDTH / 2, -leanY * FLENGTH / 2);

        sctx.fillStyle = 'red';
        sctx.fillRect(-5, -5, 10, 10);

        sctx.translate()
    }
</script>
</html>
